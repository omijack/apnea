<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Buceador Auto-Scroller</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; text-align: center; background: #000; }
    canvas { display: block; margin: 0 auto; }
    #diveButton, #retryButton {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 20px;
      z-index: 10;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #retryButton {
      display: none;
    }
    #timer {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: white;
      z-index: 10;
    }
    #finalScore {
      position: absolute;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 36px;
      color: yellow;
      font-weight: bold;
      display: none;
      z-index: 10;
    }
    #leaderboard {
      position: absolute;
      top: 220px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      color: white;
      display: none;
      z-index: 10;
      text-align: left;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
<button id="diveButton">Dive!</button>
<button id="retryButton">Reintentar</button>
<div id="timer">00.00</div>
<div id="finalScore">Final Time: 00.00</div>
<div id="leaderboard">
  <strong>Top 5:</strong>
  <ol id="scoreList"></ol>
</div>
<script>
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
      default: 'arcade',
    },
    scene: {
      preload: preload,
      create: create,
      update: update
    }
  };

  let game = new Phaser.Game(config);

  let background;
  let beachImage;
  let diver;
  let scrollSpeed = 1;
  let isScrolling = false;
  let elapsedTime = 0;
  let music;

  function preload() {
    this.load.image('background', 'assets/space3.png');
    this.load.image('beach', 'assets/beach.png');
    this.load.image('diver', 'assets/diver.png');
    this.load.audio('bgmusic', 'assets/dive.mp3');
  }

  function create() {
    background = this.add.tileSprite(0, 0, 800, 600, 'background');
    background.setOrigin(0, 0);

    beachImage = this.add.image(400, 300, 'beach');
    beachImage.setDisplaySize(800, 600);
    beachImage.setVisible(false);

    diver = this.add.sprite(400, 300, 'diver');
    diver.setScale(1.5);
    diver.setAngle(180);

    music = this.sound.add('bgmusic', { loop: true, volume: 0.5 });

    document.getElementById("diveButton").addEventListener("click", () => {
      isScrolling = !isScrolling;
      document.getElementById("diveButton").textContent = isScrolling ? "Pause" : "Dive!";

      if (isScrolling) {
        if (!music.isPlaying) music.play();
        background.setVisible(true);
        beachImage.setVisible(false);
        diver.setAngle(180);
        document.getElementById("finalScore").style.display = "none";
        document.getElementById("leaderboard").style.display = "none";
      } else {
        music.stop();
        background.setVisible(false);
        beachImage.setVisible(true);
        diver.setAngle(0);

        const seconds = Math.floor(elapsedTime / 1000);
        const hundredths = Math.floor((elapsedTime % 1000) / 10);
        const finalTime = `${seconds.toString().padStart(2, '0')}.${hundredths.toString().padStart(2, '0')}`;
        document.getElementById("finalScore").textContent = `Final Time: ${finalTime}`;
        document.getElementById("finalScore").style.display = "block";
        document.getElementById("diveButton").disabled = true;
        document.getElementById("retryButton").style.display = "inline-block";

        let scores = JSON.parse(localStorage.getItem('scores') || '[]');
        scores.push(parseFloat(finalTime));
        scores.sort((a, b) => b - a);
        scores = scores.slice(0, 5);
        localStorage.setItem('scores', JSON.stringify(scores));

        const scoreList = document.getElementById("scoreList");
        scoreList.innerHTML = "";
        scores.forEach(score => {
          const li = document.createElement("li");
          li.textContent = score.toFixed(2);
          scoreList.appendChild(li);
        });
        document.getElementById("leaderboard").style.display = "block";
      }
    });

    document.getElementById("retryButton").addEventListener("click", () => {
      game.destroy(true);
      document.location.reload();
    });
  }

  function update(time, delta) {
    if (isScrolling) {
      background.tilePositionY += scrollSpeed;
      elapsedTime += delta;
      const seconds = Math.floor(elapsedTime / 1000);
      const hundredths = Math.floor((elapsedTime % 1000) / 10);
      document.getElementById("timer").textContent = `${seconds.toString().padStart(2, '0')}.${hundredths.toString().padStart(2, '0')}`;
    }
  }
</script>
</body>
</html>